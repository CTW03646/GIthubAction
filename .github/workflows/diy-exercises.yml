name: Greeting data academy

on:
  push:
    branches-ignore: [main]

env:
  DAY_OF_WEEK: MONDAY

jobs:
  greeting_job:
    runs-on: self-hosted
    env:
      GREETING: Hello
    steps:
      - name: "Say 'Hello Data Academy 7th edition, this is $DAY_OF_WEEK 's first exercise! I'm <name>!'"
        run: echo "$GREETING $ACADEMY_TYPE Academy 7th edition, this is $DAY_OF_WEEK's first exercise!I'm $GITHUB_ACTOR!"
        env:
          ACADEMY_TYPE: Data

  greet_job:
    needs: greeting_job
    runs-on: self-hosted
    env:
      DAY: 22
      MONTH: APRIL
    steps:
      - name: "Say 'Hello Data Academy 7th edition, this is $DAY_OF_WEEK 's first exercise! I'm <name>!'"
        run: echo "Today is $DAY of $MONTH"
        env:
          ACADEMY_TYPE: Data

  checkov-job:
    runs-on: self-hosted
    name: checkov-action
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: Run Checkov action
        id: checkov
        uses: bridgecrewio/checkov-action@v12
        with:
          directory: 02_devops_fundamentals/ci_cd/terraform-exercise-3a/
          soft_fail: true # optional: do not return an error code if there are failed checks
  
  python-test:
    runs-on: self-hosted
    steps:
      - name: Py test
        run: pytest 02_devops_fundamentals/ci_cd/terraform-exercise-3/unittests/test.py